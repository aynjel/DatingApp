<form
  [formGroup]="memberDetailsForm"
  (ngSubmit)="onCreateMemberDetailsSubmit()"
  class="flex flex-col gap-6"
>
  <!-- Email -->
  <div>
    <label class="input w-full">
      <lucide-icon [name]="lockIcon" class="size-4 mr-2 text-gray-400" />
      <input
        type="email"
        [value]="currentUser()?.email"
        disabled
        class="cursor-not-allowed"
      />
    </label>
  </div>

  <!-- Display Name -->
  <div>
    <label class="label">
      <span class="label-text font-semibold">Display Name</span>
    </label>
    <input
      type="text"
      formControlName="displayName"
      class="input input-bordered w-full"
      [class.input-error]="
        memberDetailsForm.get('displayName')?.invalid &&
        memberDetailsForm.get('displayName')?.touched
      "
      [class.input-success]="
        memberDetailsForm.get('displayName')?.valid &&
        memberDetailsForm.get('displayName')?.touched
      "
      placeholder="Enter your display name"
    />
  </div>

  <!-- Date of Birth and Gender -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label class="label">
        <span class="label-text font-semibold">Date of Birth</span>
      </label>
      <input
        type="date"
        formControlName="dateOfBirth"
        class="input input-bordered w-full"
        [class.input-error]="
          memberDetailsForm.get('dateOfBirth')?.invalid &&
          memberDetailsForm.get('dateOfBirth')?.touched
        "
        [class.input-success]="
          memberDetailsForm.get('dateOfBirth')?.valid &&
          memberDetailsForm.get('dateOfBirth')?.touched
        "
      />
      @if(memberDetailsForm.get('dateOfBirth')?.invalid &&
      memberDetailsForm.get('dateOfBirth')?.touched) {
      <span class="text-error text-xs mt-1"> Date of birth is required. </span>
      }
    </div>

    <div>
      <label class="label">
        <span class="label-text font-semibold">Gender</span>
      </label>
      <select
        formControlName="gender"
        class="select select-bordered w-full"
        [class.input-error]="
          memberDetailsForm.get('gender')?.invalid &&
          memberDetailsForm.get('gender')?.touched
        "
        [class.input-success]="
          memberDetailsForm.get('gender')?.valid &&
          memberDetailsForm.get('gender')?.touched
        "
      >
        <option value="" disabled selected>Select gender</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
        <option value="other">Other</option>
      </select>
      @if(memberDetailsForm.get('gender')?.invalid &&
      memberDetailsForm.get('gender')?.touched) {
      <span class="text-error text-xs mt-1"> Gender is required. </span>
      }
    </div>
  </div>

  <!-- Location -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label class="label">
        <span class="label-text font-semibold">City</span>
      </label>
      <input
        type="text"
        formControlName="city"
        class="input input-bordered w-full"
        [class.input-error]="
          memberDetailsForm.get('city')?.invalid &&
          memberDetailsForm.get('city')?.touched
        "
        [class.input-success]="
          memberDetailsForm.get('city')?.valid &&
          memberDetailsForm.get('city')?.touched
        "
        placeholder="Enter your city"
      />
      @if(memberDetailsForm.get('city')?.invalid &&
      memberDetailsForm.get('city')?.touched) {
      <span class="text-error text-xs mt-1">
        @for(error of memberDetailsForm.get('city')?.errors | keyvalue; track
        error) { @switch (error.key) { @case ('required') { City is required. }
        @case ('minlength') { City must be at least 2 characters. } @case
        ('maxlength') { City cannot exceed 100 characters. } } }
      </span>
      }
    </div>

    <div>
      <label class="label">
        <span class="label-text font-semibold">Country</span>
      </label>
      <input
        type="text"
        formControlName="country"
        class="input input-bordered w-full"
        [class.input-error]="
          memberDetailsForm.get('country')?.invalid &&
          memberDetailsForm.get('country')?.touched
        "
        [class.input-success]="
          memberDetailsForm.get('country')?.valid &&
          memberDetailsForm.get('country')?.touched
        "
        placeholder="Enter your country"
      />
      @if(memberDetailsForm.get('country')?.invalid &&
      memberDetailsForm.get('country')?.touched) {
      <span class="text-error text-xs mt-1">
        @for(error of memberDetailsForm.get('country')?.errors | keyvalue; track
        error) { @switch (error.key) { @case ('required') { Country is required.
        } @case ('minlength') { Country must be at least 2 characters. } @case
        ('maxlength') { Country cannot exceed 100 characters. } } }
      </span>
      }
    </div>
  </div>

  <!-- Description -->
  <div>
    <label class="label">
      <span class="label-text font-semibold">About Me</span>
    </label>
    <textarea
      formControlName="description"
      class="textarea textarea-bordered w-full h-32"
      [class.input-error]="
        memberDetailsForm.get('description')?.invalid &&
        memberDetailsForm.get('description')?.touched
      "
      [class.input-success]="
        memberDetailsForm.get('description')?.valid &&
        memberDetailsForm.get('description')?.touched
      "
      placeholder="Tell us about yourself..."
    ></textarea>
    @if(memberDetailsForm.get('description')?.invalid &&
    memberDetailsForm.get('description')?.touched) {
    <span class="text-error text-xs mt-1">
      @for(error of memberDetailsForm.get('description')?.errors | keyvalue;
      track error) { @switch (error.key) { @case ('required') { Description is
      required. } @case ('minlength') { Description must be at least 10
      characters. } @case ('maxlength') { Description cannot exceed 500
      characters. } } }
    </span>
    }
  </div>

  <!-- Interests -->
  <div>
    <label class="label">
      <span class="label-text font-semibold">Interests</span>
    </label>
    <div class="flex flex-wrap gap-2 mb-2">
      @for(interest of getSelectedInterests(); track interest) {
      <div class="badge badge-lg badge-outline gap-2">
        <span>{{ interest }}</span>
        <button
          type="button"
          (click)="removeInterest(interest)"
          class="btn btn-xs btn-circle btn-ghost p-0 h-4 w-4 min-h-0"
        >
          <lucide-icon [name]="removeIcon" class="size-3" />
        </button>
      </div>
      }
    </div>
    <div class="flex gap-2">
      <div class="flex-1">
        <input
          type="text"
          [value]="interestInput()"
          (input)="interestInput.set($any($event.target).value)"
          class="input input-bordered w-full"
          [class.input-error]="
            (memberDetailsForm.get('interests')?.invalid &&
              memberDetailsForm.get('interests')?.touched) ||
            interestError()
          "
          [class.input-success]="
            memberDetailsForm.get('interests')?.valid &&
            memberDetailsForm.get('interests')?.touched
          "
          [disabled]="getSelectedInterests().length >= maxInterests"
          placeholder="Add an interest"
          (keydown.enter)="addInterest($event)"
        />
        @if(memberDetailsForm.get('interests')?.invalid &&
        memberDetailsForm.get('interests')?.touched) {
        <span class="text-error text-xs mt-1 block">
          @for(error of memberDetailsForm.get('interests')?.errors | keyvalue;
          track error) { @switch (error.key) { @case ('required') {
          <span>At least one interest is required.</span>
          } } }
        </span>
        }
      </div>
      <button
        type="button"
        class="btn btn-primary"
        (click)="addInterest($event)"
        [disabled]="
          getSelectedInterests().length >= maxInterests ||
          interestInput().trim() === ''
        "
      >
        <lucide-icon [name]="addIcon" class="size-4" />
        Add
      </button>
    </div>
    @if(interestError()) {
    <span class="text-error text-xs mt-1 block">{{ interestError() }}</span>
    }
    <span class="text-xs text-info mt-1 block">
      <lucide-icon [name]="infoIcon" class="size-4 inline-block mr-1" />
      You can add up to {{ maxInterests }} interests.
    </span>
  </div>

  <!-- Submit Button -->
  <div class="card-actions justify-end mt-4">
    <button
      type="submit"
      class="btn btn-primary w-full md:w-auto"
      [disabled]="memberDetailsForm.invalid || isLoading()"
    >
      @if(isLoading()) {
      <span class="loading loading-spinner loading-xs"></span>
      } @else { Save }
    </button>
  </div>
</form>
