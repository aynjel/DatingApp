import{a as j}from"./chunk-TPVZAPYQ.js";import{a as k}from"./chunk-CBF35FRT.js";import{a as O,b as u,c as y,d as D,e as A,f as S,g as p,h as v,i as d,j as b,k as w,l as F}from"./chunk-XZSLKHTU.js";import{f as C}from"./chunk-YAPC6UNN.js";import{l as h}from"./chunk-PD326AGR.js";import{Kb as N,Lb as x,M,P,R as c,ga as E,ra as g}from"./chunk-BENNHJVS.js";import{a as K,b as $}from"./chunk-GH7VMSIE.js";var le=Symbol("DEVTOOLS_FEATURE");var de=new P("ReduxDevtoolsConfig");var fe=new P("Array contain existing names for the signal stores",{factory:()=>[],providedIn:"root"});function T(){return S(p(()=>({_resetState:{value:{}}})),d(e=>({resetState(){u(e,e._resetState.value)},__setResetState__(r){e._resetState.value=r}})),v(e=>({onInit(){e._resetState.value=y(e)}})))}var I=Symbol("SYNC_STATUS");var L=(()=>{let n=class n{getItem(t){return localStorage.getItem(t)}setItem(t,o){return localStorage.setItem(t,o)}clear(t){return localStorage.removeItem(t)}};n.\u0275fac=function(o){return new(o||n)},n.\u0275prov=M({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})(),V=(()=>{let n=class n{getItem(t){return sessionStorage.getItem(t)}setItem(t,o){return sessionStorage.setItem(t,o)}clear(t){return sessionStorage.removeItem(t)}};n.\u0275fac=function(o){return new(o||n)},n.\u0275prov=M({token:n,factory:n.\u0275fac,providedIn:"root"});let e=n;return e})();function _(){return R(L)}function z(){return R(V)}function R(e){function n({key:r,parse:t,select:o,stringify:i},f,m){if(m)return{clearStorage:()=>{},readFromStorage:()=>{},writeToStorage:()=>{}};let l=c(e);return{clearStorage(){l.clear(r)},readFromStorage(){let a=l.getItem(r);a&&u(f,t(a))},writeToStorage(){let a=o(y(f));l.setItem(r,i(a))}}}return n.type="sync",n}function U(e,n){if(typeof e!="string"&&e.storage&&n)throw new Error("You can either pass a storage strategy or a config with storage, but not both.");let r=K({autoSync:!0,select:o=>o,parse:JSON.parse,stringify:JSON.stringify,storage:()=>localStorage},typeof e=="string"?{key:e}:e),t=n??(r.storage()===localStorage?_():z());return t.type==="sync"?B(t,r):J(t,r)}function B(e,n){return S(d((r,t=c(g))=>e(n,r,h(t))),v({onInit(r,t=c(g)){h(t)||n.autoSync&&(r.readFromStorage(),D(r,()=>r.writeToStorage()))}}))}function J(e,n){return S(p(()=>{let r={[I]:E("idle")},t=[];return x(()=>{r[I]()==="synced"&&(t.forEach(i=>i()),t.splice(0,t.length))}),$(K({},r),{isSynced:N(()=>r[I]()==="synced"),whenSynced:()=>new Promise(o=>{r[I]()==="synced"?o():t.push(o)})})}),d((r,t=c(g))=>e(n,r,h(t))),v({async onInit(r,t=c(g)){if(h(t))return;let o=JSON.stringify(y(r));if(n.autoSync){let i=!1;D(r,()=>{if(!i){if(JSON.stringify(y(r))===o)return;console.warn(`Writing to Store (${n.key}) happened before the state was initially read from storage.`,"Please ensure that the store is not in syncing state via `store.whenSynced()` before writing to the state.","Alternatively, you can disable autoSync by passing `autoSync: false` in the config.");return}return r.writeToStorage()}),await r.readFromStorage(),i=!0}}}))}var ge=S(b({}));var W={currentUser:void 0,memberDetails:void 0,isLoggedIn:!1,token:void 0},Pe=A({providedIn:"root"},b(W),U("auth"),T(),p(()=>({globalStore:c(F),authService:c(k),memberService:c(j),toastService:c(O),router:c(C)})),d(e=>{let n=a=>{u(e,{currentUser:a})},r=a=>{u(e,{memberDetails:a})},t=a=>{u(e,{isLoggedIn:a})},o=a=>{u(e,{token:a})},i=e.globalStore.withFormSubmission(a=>e.authService.login(a).pipe(w({next:s=>{e.toastService.show(`Welcome ${s.displayName}!`,"success"),t(!0),o(s.token),l()},error:s=>{console.error("Login error:",s)}}))),f=e.globalStore.withFormSubmission(a=>e.authService.registerUser(a).pipe(w({next:s=>{e.toastService.show(`Welcome ${s.displayName}!`,"success"),t(!0),o(s.token),l()},error:s=>{console.error("Registration error:",s)}}))),m=()=>{e.resetState(),t(!1),o(void 0),n(void 0),e.toastService.show("Logged out successfully.","success"),e.router.navigate(["/home"])},l=e.globalStore.withApiState(()=>e.authService.getCurrentUser().pipe(w({next:a=>{n(a),r(a.memberDetails)},error:a=>{console.error("Get Current User error:",a),setTimeout(()=>{m()},1e3)}})));return{signIn:i,signUp:f,logout:m,getCurrentUser:l,setMemberDetails:r}}));export{Pe as a};
//# sourceMappingURL=chunk-OJW6FSEX.js.map
